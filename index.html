<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ScreenCloud ROI Calculator V7.6</title> <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --brand-dark-start: #3a3a3a; --brand-dark-end: #1e1e1e;
            --brand-medium-dark: #2c2c2c; --brand-yellow: #FFD100;
            --brand-white: #FFFFFF; --text-primary: var(--brand-white);
            --text-secondary: #b0b0b0; --input-bg: #333333;
            --input-border: #444444; --slider-track: #555555; 
            --slider-thumb: var(--brand-yellow);
            --font-main: 'Inter', system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
            --green-accent: #4CAF50; --blue-accent: #2196F3; 
        }
        body {
            font-family: var(--font-main); background: linear-gradient(135deg, var(--brand-dark-start) 0%, var(--brand-dark-end) 100%);
            color: var(--text-primary); margin: 0; padding: 20px; display: flex; justify-content: center; align-items: flex-start; min-height: 100vh; overflow-y: auto;
        }
        .roi-calculator-container { width: 100%; max-width: 1150px; margin-top: 20px; margin-bottom: 20px; }
        .value-area-selector { background-color: var(--brand-medium-dark); padding: 30px 35px; border-radius: 12px; box-shadow: 0 10px 35px rgba(0, 0, 0, 0.4); margin-bottom: 30px; }
        .value-area-selector h1 { color: var(--brand-yellow); text-align: center; font-size: 2em; margin-bottom: 15px; font-weight: 700; }
        .value-area-selector p { text-align: center; color: var(--text-secondary); margin-bottom: 15px; font-size: 0.95em; } /* Reduced margin for toggle */
        .toggle-all-container { text-align: right; margin-bottom: 15px; }
        .value-options-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .value-option { background-color: var(--input-bg); padding: 18px 20px; border-radius: 8px; border: 1px solid var(--input-border); cursor: pointer; transition: background-color 0.3s ease, border-color 0.3s ease; display: flex; align-items: center; }
        .value-option:hover { background-color: #3a3a3a; }
        .value-option.selected { background-color: rgba(255, 209, 0, 0.1); border-color: var(--brand-yellow); }
        .value-option input[type="checkbox"] { margin-right: 12px; width: 18px; height: 18px; accent-color: var(--brand-yellow); }
        .value-option label { font-weight: 600; font-size: 0.95em; color: var(--text-primary); flex-grow: 1; }
        .value-option label .emoji { margin-right: 8px; }
        #errorMessage { color: #ff6b6b; text-align: center; margin-bottom: 15px; font-size: 0.9em; min-height: 1.2em; }
        .next-button-container { text-align: center; }
        #selectionNextButton { padding: 12px 30px; background-color: var(--brand-yellow); color: var(--brand-medium-dark); text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 1em; border: none; cursor: pointer; transition: background-color 0.3s ease; }
        #selectionNextButton:disabled { background-color: var(--slider-track); color: #888; cursor: not-allowed; }
        #selectionNextButton:not(:disabled):hover { background-color: #e6bb00; }
        .roi-calculator { background-color: var(--brand-medium-dark); padding: 30px 35px; border-radius: 12px; box-shadow: 0 10px 35px rgba(0, 0, 0, 0.4); position: relative; display: none; }
        .change-selections-main-container { text-align: left; margin-bottom: 20px; }
        .secondary-button { padding: 8px 15px; background-color: transparent; color: var(--text-secondary); border: 1px solid var(--input-border); border-radius: 6px; font-weight: 600; font-size: 0.85em; cursor: pointer; transition: background-color 0.3s ease, color 0.3s ease, border-color 0.3s ease; }
        .secondary-button:hover { background-color: rgba(255, 255, 255, 0.05); border-color: var(--brand-yellow); color: var(--brand-yellow); }
        .value-area-group { margin-bottom: 30px; padding: 20px; border: 1px solid var(--input-border); border-radius: 8px; background-color: #252525; }
        .value-area-group h3 { color: var(--brand-yellow); font-size: 1.2em; margin-top: 0; margin-bottom: 20px; padding-bottom: 10px; border-bottom: 1px solid var(--input-border); }
        .form-group { margin-bottom: 20px; display: flex; text-align: center; flex-direction: column; position: relative; }
        .form-group label { display: flex; flex-direction: column; align-items: center; margin-bottom: 8px; font-weight: 600; text-align: center; color: var(--text-secondary); font-size: 0.9em; }
        .label-text-wrapper { display: flex; align-items: center; justify-content: center; }
        .info-icon-wrapper { display: inline-flex; align-items: center; position: relative; margin-left: 5px; }
        .info-icon-wrapper .info-icon { color: var(--text-secondary); cursor: help; font-size: 0.85em; border: 1px solid var(--text-secondary); border-radius: 50%; width: 16px; height: 16px; display: inline-flex; justify-content: center; align-items: center; }
        .tooltip-text { visibility: hidden; width: 220px; background-color: #484848; color: #fff; text-align: left; border-radius: 6px; padding: 10px 12px; position: absolute; z-index: 10; bottom: 130%; left: 50%; transform: translateX(-50%); opacity: 0; transition: opacity 0.3s; font-size: 0.8em; box-shadow: 0 3px 8px rgba(0,0,0,0.3); }
        .info-icon-wrapper:hover .tooltip-text { visibility: visible; opacity: 1; }
        .sc-logo img { display: block; width: 100%; height: auto; border: none; }
        .roi-calculator .header-group { display: flex; align-items: center; width: fit-content; margin-left: auto; margin-right: auto; margin-bottom: 20px; }
        .roi-calculator .header-group .header-logo { width: 50px; height: auto; margin-right: 15px; display: block; }
        .roi-calculator .header-group > h1 { 
            color: var(--brand-yellow); text-align: center; font-size: 2.2em; line-height: 1.2; margin:0; font-weight: 700;
        }
        .roi-calculator .header-group > h1 .subtitle {
            display: block; font-size: 0.65em; font-weight: 600; color: var(--text-secondary); margin-top: 5px; 
        }
        .calculator-content-wrapper { display: flex; flex-direction: row; justify-content: space-between; }
        .input-section { flex: 1; min-width: 0; padding-right: 19.5px; border-right: 1px solid var(--input-border); }
        .output-section { flex: 1; min-width: 0; padding-left: 19.5px; }
        .input-section > h2:first-of-type, .output-section > h2:first-of-type { margin-top: 0; }
        h2 { color: var(--brand-yellow); text-align: center; font-size: 1.5em; border-bottom: 1px solid var(--input-border); padding-bottom: 12px; margin-bottom: 25px; font-weight: 600; }
        .form-group input[type="number"] { padding: 12px 14px; background-color: var(--input-bg); border: 1px solid var(--input-border); border-radius: 6px; text-align: center; color: var(--text-primary); font-size: 1em; font-family: var(--font-main); transition: border-color 0.3s ease, box-shadow 0.3s ease; width: 200px; margin-left: auto; margin-right: auto; box-sizing: border-box; }
        .form-group input[type="number"]:focus { outline: none; border-color: var(--brand-yellow); box-shadow: 0 0 0 3px rgba(255, 209, 0, 0.25); }
        .form-group input[type="number"]::-webkit-inner-spin-button, .form-group input[type="number"]::-webkit-outer-spin-button { -webkit-appearance: none; margin: 0; }
        .form-group input[type="number"] { -moz-appearance: textfield; }
        .slider-wrapper { margin-bottom: 25px; margin-top: 5px; padding: 10px; background-color: #252525; border-radius:8px; border: 1px solid var(--input-border); }
        .slider-main-label { display: block; text-align: center; margin-bottom: 15px; font-weight: 600; color: var(--text-secondary); font-size: 0.95em; }
        .slider-container { display: flex; align-items: center; justify-content: space-between; margin-bottom: 8px; }
        .slider-end-labels { color: var(--text-secondary); font-size: 0.85em; flex-basis: 90px; }
        .slider-end-labels.conservative { text-align: left; }
        .slider-end-labels.aggressive { text-align: right; }
        input[type="range"] { -webkit-appearance: none; appearance: none; flex-grow: 1; height: 10px; background: var(--slider-track); border-radius: 5px; outline: none; margin: 0 15px; }
        input[type="range"]::-webkit-slider-thumb { -webkit-appearance: none; appearance: none; width: 22px; height: 22px; background: var(--slider-thumb); border-radius: 50%; cursor: pointer; border: 3px solid var(--brand-medium-dark); box-shadow: 0 0 5px rgba(0,0,0,0.3); }
        input[type="range"]::-moz-range-thumb { width: 20px; height: 20px; background: var(--slider-thumb); border-radius: 50%; cursor: pointer; border: 3px solid var(--brand-medium-dark); box-shadow: 0 0 5px rgba(0,0,0,0.3); }
        /* #slider-value-display REMOVED */
        .output-metric { background-color: var(--input-bg); padding: 15px; border-radius: 8px; margin-bottom: 15px; border-left: 5px solid var(--brand-yellow); transition: transform 0.2s ease-out; }
        .output-metric:hover { transform: translateY(-2px); }
        .output-metric p { margin: 0; font-size: 0.85em; color: var(--text-secondary); margin-bottom: 5px; }
        .output-metric span { display: block; font-size: 1.5em; font-weight: 700; color: var(--brand-white); }
        .print-only-outputs-header { display: none; }
        .output-metric.total-benefit { margin-top: 25px; }
        .output-metric.total-benefit span { color: var(--brand-yellow); font-size: 1.7em; }
        .metric-detail { margin-top: 6px; font-size: 0.7em; display: flex; align-items: center; font-weight: 600; }
        .metric-detail.reduction { color: var(--green-accent); }
        .metric-detail.improvement { color: var(--blue-accent); }
        .metric-detail .arrow { margin-right: 5px; font-weight: bold; font-size: 0.8em; }
        .video-link-container { margin-top: 8px; font-size: 0.8em; }
        .video-testimonial-link { color: var(--brand-yellow); text-decoration: none; display: inline-flex; align-items: center; padding: 5px 8px; border-radius: 4px; background-color: rgba(255, 255, 255, 0.05); transition: background-color 0.3s ease, text-decoration 0.3s ease; }
        .video-testimonial-link:hover, .video-testimonial-link:focus { background-color: rgba(255, 255, 255, 0.1); text-decoration: none; outline: none; }
        .video-testimonial-link svg { width: 14px; height: 14px; margin-right: 6px; fill: currentColor; }
        .lock-in-link-container { display: flex; gap: 10px; align-items: center; flex-wrap: wrap; margin-top: 15px; }
        .lock-in-benefits-link { display: inline-block; padding: 10px 18px; background-color: var(--brand-yellow); color: var(--brand-medium-dark); text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9em; transition: background-color 0.3s ease, transform 0.2s ease; border: 1px solid var(--brand-yellow); }
        .lock-in-benefits-link:hover, .lock-in-benefits-link:focus { background-color: #e6bb00; color: var(--brand-medium-dark); text-decoration: none; transform: translateY(-1px); outline: none; }
        .share-results-button { display: inline-block; padding: 10px 18px; background-color: transparent; color: var(--brand-yellow); text-decoration: none; border-radius: 6px; font-weight: 600; font-size: 0.9em; transition: background-color 0.3s ease, color 0.3s ease, transform 0.2s ease; border: 1px solid var(--brand-yellow); cursor: pointer; }
        .share-results-button:hover, .share-results-button:focus { background-color: rgba(255, 209, 0, 0.1); color: var(--brand-yellow); text-decoration: none; transform: translateY(-1px); outline: none; }
        @media (max-width: 992px) {
            .calculator-content-wrapper { flex-direction: column; gap: 0px; }
            .input-section { padding-right: 0; border-right: none; border-bottom: 1px solid var(--input-border); padding-bottom: 20px; margin-bottom:20px; }
            .output-section { padding-left: 0; }
            .output-section > h2:first-of-type { margin-top: 0px; }
            .roi-calculator-container { max-width: 680px; }
            .form-group input[type="number"] { max-width: 100%; }
            .roi-calculator .header-group > h1 { margin-top: 15px; }
        }
        @media (max-width: 768px) { .value-options-grid { grid-template-columns: 1fr; } }
        @media (max-width: 480px) {
            .value-area-selector, .roi-calculator { padding: 20px 15px; }
            .value-area-selector h1 { font-size: 1.8em; }
            .roi-calculator .header-group > h1 { font-size: 1.8em; margin-top: 10px; }
            .roi-calculator .header-group > h1 .subtitle { font-size: 0.6em; }
            .roi-calculator h2 { font-size: 1.3em; }
            .output-metric span { font-size: 1.3em; }
            .output-metric.total-benefit span { font-size: 1.5em; }
            .lock-in-link-container { justify-content: center; }
         }
        @media print {
            body { background: #fff !important; color: #000 !important; margin: 0; padding: 0; }
            .value-area-selector, .change-selections-main-container, .slider-wrapper { display: none !important; } 
            .roi-calculator-container { margin: 0 !important; max-width: 100% !important; }
            .roi-calculator { box-shadow: none !important; border: 1px solid #ccc !important; margin: 20px auto !important; padding: 15px !important; max-width: 100% !important; width: auto !important; display: block !important; }
            .input-section { display: none !important; }
            .output-section { padding-left: 0 !important; border-left: none !important; }
            .lock-in-benefits-link, .share-results-button, .video-testimonial-link, .info-icon-wrapper, .metric-detail { display: none !important; }
             .screen-only-outputs-header { display: none !important; }
             .print-only-outputs-header { display: block !important; margin-top: 0 !important; color: var(--brand-yellow) !important; }
             h1, h2, .output-metric p, .output-metric span, .form-group label { color: #333 !important; }
             .roi-calculator .header-group > h1 .subtitle { color: #555 !important; }
             .output-metric.total-benefit span { color: var(--brand-yellow) !important; }
             .output-metric { background-color: #f9f9f9 !important; border-left-color: var(--brand-yellow) !important; }
        }
    </style>
</head>
<body>
    <div class="roi-calculator-container">
        <div class="value-area-selector" id="valueAreaSelector">
            <h1>Select Your Key Value Areas</h1>
            <p>Choose at least two areas where you see the most potential for improvement with ScreenCloud.</p>
            <div class="toggle-all-container">
                <button type="button" id="toggleAllValueAreasButton" class="secondary-button" style="font-size: 0.8em; padding: 6px 12px;">Select All</button>
            </div>
            <div class="value-options-grid" id="valueOptionsGrid">
                <div class="value-option" data-value="content_engagement"><input type="checkbox" id="chkContentEngagement" name="value_areas" value="content_engagement"><label for="chkContentEngagement"><span class="emoji">📊</span>Content Engagement</label></div>
                <div class="value-option" data-value="employee_satisfaction"><input type="checkbox" id="chkEmployeeSatisfaction" name="value_areas" value="employee_satisfaction"><label for="chkEmployeeSatisfaction"><span class="emoji">😊</span>Employee Satisfaction & Retention</label></div>
                <div class="value-option" data-value="safety_compliance"><input type="checkbox" id="chkSafetyCompliance" name="value_areas" value="safety_compliance"><label for="chkSafetyCompliance"><span class="emoji">🦺</span>Safety + Compliance</label></div>
                <div class="value-option" data-value="it_maintenance"><input type="checkbox" id="chkItMaintenance" name="value_areas" value="it_maintenance"><label for="chkItMaintenance"><span class="emoji">🧑‍💻</span>IT Maintenance</label></div>
                <div class="value-option" data-value="comms_efficiency"><input type="checkbox" id="chkCommsEfficiency" name="value_areas" value="comms_efficiency"><label for="chkCommsEfficiency"><span class="emoji">📣</span>Comms Team Efficiency</label></div>
                <div class="value-option" data-value="employee_productivity"><input type="checkbox" id="chkEmployeeProductivity" name="value_areas" value="employee_productivity"><label for="chkEmployeeProductivity"><span class="emoji">⚙️</span>Employee Productivity</label></div>
            </div>
            <div id="errorMessage"></div>
            <div class="next-button-container"><button type="button" id="selectionNextButton" disabled>Next</button></div>
        </div>

        <div class="roi-calculator" id="roiCalculatorMain">
            <div class="header-group">
                <img src="https://i.ibb.co/7xhtjvRN/Symbol-For-Dark-Theme-2x.png" alt="ScreenCloud Logo" class="header-logo">
                <h1>ScreenCloud<span class="subtitle">Value Calculator</span></h1>
            </div>
            <div class="change-selections-main-container">
                <button type="button" id="backToSelectionButton" class="secondary-button">← Change Selections</button>
            </div>
            <div class="calculator-content-wrapper">
                <div class="input-section" id="inputSection"></div>
                <div class="output-section" id="outputSection">
                    <div class="slider-wrapper" id="estimateSliderWrapper">
                        <label class="slider-main-label" for="estimateSlider">Adjust Estimated Impact:</label>
                        <div class="slider-container">
                            <span class="slider-end-labels conservative">Conservative</span>
                            <input type="range" id="estimateSlider" min="-12.5" max="12.5" step="0.1" value="0">
                            <span class="slider-end-labels aggressive">Aggressive</span>
                        </div>
                        </div>
                    <div class="output-metric total-benefit">
                        <p>Total Estimated Annual Benefit</p>
                        <span id="outputTotalAnnualBenefit">$0</span>
                        <div class="lock-in-link-container">
                            <a href="https://screencloud.com/demo-request" target="_blank" rel="noopener noreferrer" class="lock-in-benefits-link">Lock in these benefits</a>
                            <button type="button" id="shareResultsBtn" class="share-results-button">Share results</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
    document.addEventListener('DOMContentLoaded', function () {
        const valueAreaSelector = document.getElementById('valueAreaSelector');
        const roiCalculatorMain = document.getElementById('roiCalculatorMain');
        const valueOptionsGrid = document.getElementById('valueOptionsGrid');
        const selectionNextButton = document.getElementById('selectionNextButton');
        const errorMessage = document.getElementById('errorMessage');
        const backToSelectionButton = document.getElementById('backToSelectionButton');
        const inputSection = document.getElementById('inputSection');
        const outputSection = document.getElementById('outputSection');
        const outputTotalAnnualBenefit = document.getElementById('outputTotalAnnualBenefit');
        const shareResultsBtn = document.getElementById('shareResultsBtn');
        const estimateSlider = document.getElementById('estimateSlider');
        // const sliderValueDisplay = document.getElementById('slider-value-display'); // REMOVED

        const toggleAllValueAreasButton = document.getElementById('toggleAllValueAreasButton'); // Added
        let isSelectAllActive = false; // Added for toggle state

        const VALUE_AREAS = {
            content_engagement: {
                label: "📊 Content Engagement",
                inputs: [
                    { id: 'numEmployees', label: 'Number of employees', type: 'number', value: 100, min:0, tooltip: 'Total number of employees in your organization.' , isCommon: true},
                    { id: 'percentFrontline', label: '% of employees that are frontline/deskless', type: 'number', value: 70, min:0, max:100, tooltip: 'Percentage of your total workforce that are not primarily at a desk (e.g., factory, retail, field workers).', isCommon: true },
                    { id: 'contentEngagementRate', label: 'Current content engagement rate (%)', type: 'number', value: 40, min:0, max:100, tooltip: "Your organization's current rate of employee interaction with internal content." }
                ],
                outputs: [ { id: 'outputNewEngagementRate', label: 'New Estimated Engagement Rate', type: 'kpi', hasImprovementDetail: true } ],
                calculate: function(inputs) { 
                    const frontline_ratio = (parseFloat(inputs.percentFrontline) || 0) / 100;
                    const non_frontline_ratio = 1 - frontline_ratio;
                    const frontline_uplift_baseline = 22; 
                    const non_frontline_uplift_baseline = 11;
                    const engagement_uplift_points_baseline = (frontline_uplift_baseline * frontline_ratio) + (non_frontline_uplift_baseline * non_frontline_ratio);
                    return { 
                        currentEngagementRateBaseline: parseFloat(inputs.contentEngagementRate) || 0, 
                        engagementUpliftBaseline: engagement_uplift_points_baseline
                    };
                }
            },
            employee_satisfaction: {
                label: "😊 Employee Satisfaction & Retention",
                inputs: [
                    { id: 'numEmployees', label: 'Number of employees', type: 'number', value: 100, min:0, tooltip: 'Total number of employees in your organization.', isCommon: true },
                    { id: 'currentEmployeeTurnoverRate', label: 'Current annual employee turnover rate (%)', type: 'number', value: 20, min:0, tooltip: 'Your current annual employee turnover percentage (e.g., enter 15 for 15%).' },
                    { id: 'avgAnnualWage', label: 'Average fully loaded annual wage ($)', type: 'number', value: 50000, min:0, tooltip: 'Include salary, benefits, and other direct costs per employee.', isCommon: true },
                    { id: 'currentEnps', label: 'Current eNPS', type: 'number', value: 30, tooltip: 'Your current Employee Net Promoter Score, typically ranging from -100 to 100.' }
                ],
                outputs: [ 
                    { id: 'outputNewTurnoverRate', label: 'New Estimated Turnover Rate', type: 'kpi', hasReductionDetail: true },
                    { id: 'outputTurnoverReductionSavings', label: 'Turnover Reduction Savings', type: 'currency' }, 
                    { id: 'outputNewEnps', label: 'New eNPS', type: 'kpi', hasImprovementDetail: true }
                ],
                calculate: function(inputs) { 
                    const baseTurnoverRatePercent = parseFloat(inputs.currentEmployeeTurnoverRate) || 0;
                    const baseTurnoverRateDecimal = baseTurnoverRatePercent / 100;
                    return {
                        baseTurnoverRateDecimal: baseTurnoverRateDecimal,
                        numEmployees: parseFloat(inputs.numEmployees) || 0,
                        avgAnnualWage: parseFloat(inputs.avgAnnualWage) || 0,
                        currentEnpsBaseline: parseFloat(inputs.currentEnps) || 0,
                        enpsNeutralImprovementBaseline: 20 
                    };
                }
            },
            safety_compliance: {
                label: "🦺 Safety + Compliance",
                inputs: [
                    { id: 'oshaViolationsPerYear', label: 'Annual OSHA violations', type: 'number', value: 2, min:0, tooltip: 'Total number of OSHA (or equivalent) safety violations recorded in the last year.' },
                    { id: 'repeatViolationsPerYear', label: 'Annual repeat OSHA violations', type: 'number', value: 0.2, min:0, step: 0.1, tooltip: 'Number of OSHA (or equivalent) violations that were repeat offenses in the last year.' }
                ],
                outputs: [ { id: 'outputComplianceSavings', label: 'Compliance Savings', type: 'currency' } ],
                calculate: function(inputs) { 
                    const oshaViolations = parseFloat(inputs.oshaViolationsPerYear) || 0;
                    const repeatViolations = parseFloat(inputs.repeatViolationsPerYear) || 0;
                    const compliance_savings_baseline = (oshaViolations * 16550) + (repeatViolations * 165514);
                    return { outputComplianceSavingsBaseline: Math.max(0, compliance_savings_baseline) };
                }
            },
            it_maintenance: { 
                label: "🧑‍💻 IT Maintenance",
                inputs: [ { id: 'siteVisitsPerYear', label: 'Annual IT site visits for screen hardware', type: 'number', value: 15, min:0, tooltip: 'Number of physical site visits by IT per year to manage/fix communication hardware.' } ],
                outputs: [ { id: 'outputItSavings', label: 'IT Maintenance Savings', type: 'currency' } ],
                calculate: function(inputs) { 
                    return { siteVisits: parseFloat(inputs.siteVisitsPerYear) || 0 };
                }
            },
            comms_efficiency: {
                label: "📣 Comms Team Efficiency",
                inputs: [
                    { id: 'annualPrintCost', label: 'Annual print materials cost ($)', type: 'number', value: 65000, min:0, tooltip: 'Total yearly spending on printed communication materials (posters, newsletters, etc.).' },
                    { id: 'hoursPerWeekCommsEmployee', label: 'Weekly hours per comms member on manual distribution', type: 'number', value: 6, min:0, tooltip: 'Average hours each comms team member spends per week on tasks like creating, printing, and distributing physical communications or manually updating diverse digital systems.' },
                    { id: 'avgAnnualCommsSalary', label: 'Average comms team member salary ($)', type: 'number', value: 85000, min:0, tooltip: 'Average annual salary including benefits for an employee on the communications team.' },
                    { id: 'numCommsEmployees', label: 'Number of comms team employees', type: 'number', value: 8, min:0, tooltip: 'Total number of employees primarily responsible for creating and managing internal communications.' }
                ],
                outputs: [
                    { id: 'outputPrintSavings', label: 'Savings on Print Materials', type: 'currency' }, 
                    { id: 'outputCommsEfficiencySavings', label: 'Comms Team Efficiency Savings', type: 'currency' } 
                ],
                calculate: function(inputs) { 
                    const annualPrintCost = parseFloat(inputs.annualPrintCost) || 0;
                    const hoursPerWeek = parseFloat(inputs.hoursPerWeekCommsEmployee) || 0;
                    const avgCommsSalary = parseFloat(inputs.avgAnnualCommsSalary) || 0;
                    const numCommsEmployees = parseFloat(inputs.numCommsEmployees) || 0;
                    const print_savings = annualPrintCost;
                    const hourly_wage = avgCommsSalary / 2080; 
                    const comms_efficiency_savings_baseline = hourly_wage * hoursPerWeek * 52 * numCommsEmployees;
                    return {
                        outputPrintSavings: Math.max(0, print_savings),
                        outputCommsEfficiencySavingsBaseline: Math.max(0, comms_efficiency_savings_baseline)
                    };
                }
            },
            employee_productivity: { 
                label: "⚙️ Employee Productivity",
                inputs: [
                    { id: 'numEmployees', label: 'Number of employees', type: 'number', value: 100, min:0, tooltip: 'Total number of employees in your organization.', isCommon: true },
                    { id: 'avgAnnualWage', label: 'Average fully loaded annual wage ($)', type: 'number', value: 50000, min:0, tooltip: 'Include salary, benefits, and other direct costs per employee.', isCommon: true },
                    { id: 'percentFrontline', label: '% of employees that are frontline/deskless', type: 'number', value: 70, min:0, max:100, tooltip: 'Percentage of your total workforce that are not primarily at a desk (e.g., factory, retail, field workers).', isCommon: true }
                ],
                outputs: [ { id: 'outputProductivityValue', label: 'Value of Improved Productivity', type: 'currency', hasVideoLink: true } ],
                calculate: function(inputs) { 
                    const numEmployees = parseFloat(inputs.numEmployees) || 0;
                    const avgAnnualWage = parseFloat(inputs.avgAnnualWage) || 0;
                    const frontlinePercentage = (parseFloat(inputs.percentFrontline) || 0) / 100;
                    const frontline_employees = numEmployees * frontlinePercentage;
                    const non_frontline_employees = numEmployees * (1 - frontlinePercentage);
                    const frontline_minutes_saved_per_day = 94; const non_frontline_minutes_saved_per_day = 10;
                    const workdays_per_year = 260;
                    const frontline_total_minutes = frontline_employees * frontline_minutes_saved_per_day * workdays_per_year;
                    const non_frontline_total_minutes = non_frontline_employees * non_frontline_minutes_saved_per_day * workdays_per_year;
                    const total_minutes_saved = frontline_total_minutes + non_frontline_total_minutes;
                    const annual_work_hours = workdays_per_year * 8;
                    const hourly_wage = annual_work_hours > 0 ? avgAnnualWage / annual_work_hours : 0;
                    const productivity_value_baseline = (total_minutes_saved / 60) * hourly_wage;
                    return { outputProductivityValueBaseline: Math.max(0, productivity_value_baseline) };
                }
            }
        };

        let selectedValueAreas = []; const allInputReferences = {}; 

        // --- Select/Unselect All Logic ---
        toggleAllValueAreasButton.addEventListener('click', function() {
            isSelectAllActive = !isSelectAllActive; // Toggle the desired state
            const checkboxes = valueOptionsGrid.querySelectorAll('input[type="checkbox"]');
            checkboxes.forEach(checkbox => {
                checkbox.checked = isSelectAllActive;
                const optionDiv = checkbox.closest('.value-option');
                if (optionDiv) {
                    optionDiv.classList.toggle('selected', isSelectAllActive);
                }
            });
            this.textContent = isSelectAllActive ? 'Unselect All' : 'Select All';
            updateSelectionState(); 
        });

        valueOptionsGrid.addEventListener('click', function(event) { 
            const optionDiv = event.target.closest('.value-option'); 
            if (optionDiv) { 
                const checkbox = optionDiv.querySelector('input[type="checkbox"]'); 
                if (event.target.tagName !== 'INPUT') { checkbox.checked = !checkbox.checked; } 
                optionDiv.classList.toggle('selected', checkbox.checked); 
                updateSelectionState(); // Call this first

                // Sync toggleAll button
                const allCheckboxes = Array.from(valueOptionsGrid.querySelectorAll('input[type="checkbox"]'));
                const allCurrentlySelected = allCheckboxes.every(cb => cb.checked);
                if (allCurrentlySelected) {
                    toggleAllValueAreasButton.textContent = 'Unselect All';
                    isSelectAllActive = true;
                } else {
                    toggleAllValueAreasButton.textContent = 'Select All';
                    isSelectAllActive = false; 
                }
            } 
        });
        
        function updateSelectionState() { 
            const checkedBoxes = Array.from(valueOptionsGrid.querySelectorAll('input[type="checkbox"]:checked')); 
            selectedValueAreas = checkedBoxes.map(cb => cb.value); 
            if (selectedValueAreas.length >= 2) { 
                selectionNextButton.disabled = false; errorMessage.textContent = ''; 
            } else { 
                selectionNextButton.disabled = true; errorMessage.textContent = 'Please select at least 2 value areas.'; 
            } 
        }
        selectionNextButton.addEventListener('click', function() { if (selectedValueAreas.length >= 2) { localStorage.setItem('selectedRoiValueAreas', JSON.stringify(selectedValueAreas)); valueAreaSelector.style.display = 'none'; roiCalculatorMain.style.display = 'block'; populateCalculator(); calculateROI(); } });
        backToSelectionButton.addEventListener('click', function() { roiCalculatorMain.style.display = 'none'; valueAreaSelector.style.display = 'block'; updateSelectionState(); });
        function formatCurrency(value) { return value.toLocaleString('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 0, maximumFractionDigits: 0 }); }
        function formatPercentage(value, decimalPlaces = 1) { const numValue = Number(value); if (isNaN(numValue)) return '0.0%'; return numValue.toFixed(decimalPlaces) + '%'; }
        function createInputElement(config) { const formGroup = document.createElement('div'); formGroup.className = 'form-group'; const label = document.createElement('label'); const labelTextWrapper = document.createElement('span'); labelTextWrapper.className = 'label-text-wrapper'; const labelTextNode = document.createTextNode(config.label); labelTextWrapper.appendChild(labelTextNode); if (config.tooltip) { const infoWrapper = document.createElement('span'); infoWrapper.className = 'info-icon-wrapper'; const infoIcon = document.createElement('span'); infoIcon.className = 'info-icon'; infoIcon.textContent = '?'; const tooltipText = document.createElement('span'); tooltipText.className = 'tooltip-text'; tooltipText.textContent = config.tooltip; infoWrapper.appendChild(infoIcon); infoWrapper.appendChild(tooltipText); labelTextWrapper.appendChild(infoWrapper); } label.setAttribute('for', config.id); label.appendChild(labelTextWrapper); const input = document.createElement('input'); input.type = config.type; input.id = config.id; input.value = config.value; if (config.min !== undefined) input.min = config.min; if (config.max !== undefined) input.max = config.max; if (config.step !== undefined) input.step = config.step; allInputReferences[config.id] = input; input.addEventListener('input', calculateROI); formGroup.appendChild(label); formGroup.appendChild(input); return formGroup; }
        function createOutputMetric(config, value) { const metricDiv = document.createElement('div'); metricDiv.className = 'output-metric'; if (config.id === 'outputTotalAnnualBenefit') metricDiv.classList.add('total-benefit'); const p = document.createElement('p'); p.textContent = config.label; const span = document.createElement('span'); span.id = config.id; span.textContent = value; metricDiv.appendChild(p); metricDiv.appendChild(span); if (config.hasReductionDetail || config.hasImprovementDetail) { const detailContainer = document.createElement('div'); detailContainer.className = 'metric-detail ' + (config.hasReductionDetail ? 'reduction' : 'improvement'); detailContainer.id = `metricDetailContainer_${config.id}`; detailContainer.style.display = 'none'; const arrow = document.createElement('span'); arrow.className = 'arrow'; arrow.innerHTML = config.hasReductionDetail ? '↓' : '↑'; const text = document.createElement('span'); text.id = `metricDetailText_${config.id}`; detailContainer.appendChild(arrow); detailContainer.appendChild(text); metricDiv.appendChild(detailContainer); } if (config.hasVideoLink) { const videoContainer = document.createElement('div'); videoContainer.className = 'video-link-container'; const link = document.createElement('a'); link.href = "https://youtu.be/rQRnibgEyOs?feature=shared"; link.target = "_blank"; link.rel = "noopener noreferrer"; link.className = "video-testimonial-link"; link.innerHTML = `<svg viewBox="0 0 24 24" width="16px" height="16px"><path d="M8 5v14l11-7z"></path></svg> Watch Testimonial`; videoContainer.appendChild(link); metricDiv.appendChild(videoContainer); } return metricDiv; }
        
        estimateSlider.addEventListener('input', calculateROI); // Removed updateSliderImpactDisplay call

        function populateCalculator() {
            inputSection.innerHTML = ''; 
            const totalBenefitDiv = outputSection.querySelector('.total-benefit');
            let currentChild = outputSection.firstChild;
            while(currentChild && currentChild !== totalBenefitDiv) {
                let nextChild = currentChild.nextSibling;
                if (currentChild.id !== 'estimateSliderWrapper' && (!currentChild.classList || (!currentChild.classList.contains('screen-only-outputs-header') && !currentChild.classList.contains('print-only-outputs-header')))) {
                    outputSection.removeChild(currentChild);
                }
                currentChild = nextChild;
            }

            const addedInputs = new Set(); let hasInputs = false; let hasOutputs = false;
            const inputsTitle = document.createElement('h2'); inputsTitle.textContent = "Inputs";
            inputSection.appendChild(inputsTitle);

            selectedValueAreas.forEach(areaKey => {
                const areaConfig = VALUE_AREAS[areaKey]; if (!areaConfig) return;
                const inputGroupDiv = document.createElement('div'); inputGroupDiv.className = 'value-area-group';
                const inputGroupTitle = document.createElement('h3'); inputGroupTitle.textContent = areaConfig.label;
                inputGroupDiv.appendChild(inputGroupTitle); let groupHasInputs = false;
                areaConfig.inputs.forEach(inputConf => {
                    if (inputConf.isCommon) { if (!addedInputs.has(inputConf.id)) { inputGroupDiv.appendChild(createInputElement(inputConf)); addedInputs.add(inputConf.id); groupHasInputs = true; }
                    } else { inputGroupDiv.appendChild(createInputElement(inputConf)); groupHasInputs = true; }
                });
                if (groupHasInputs) { inputSection.appendChild(inputGroupDiv); hasInputs = true; }
                areaConfig.outputs.forEach(outputConf => {
                    hasOutputs = true; 
                    let initialValue;
                    if (outputConf.type === 'currency') initialValue = formatCurrency(0);
                    else if (outputConf.type === 'kpi') initialValue = (outputConf.id === 'outputNewEnps' ? '0' : formatPercentage(0,1));
                    else initialValue = 'N/A';
                    outputSection.insertBefore(createOutputMetric(outputConf, initialValue), totalBenefitDiv);
                });
            });
            
            const sliderWrapper = document.getElementById('estimateSliderWrapper');
            if (hasOutputs) {
                let firstOutputMetric = outputSection.querySelector('.output-metric:not(.total-benefit)');
                let screenOutputsHeader = outputSection.querySelector('.screen-only-outputs-header');
                let printOutputsHeader = outputSection.querySelector('.print-only-outputs-header');
                if (!screenOutputsHeader) { screenOutputsHeader = document.createElement('h2'); screenOutputsHeader.className = 'screen-only-outputs-header'; screenOutputsHeader.textContent = 'Outputs'; outputSection.insertBefore(screenOutputsHeader, sliderWrapper); }
                if (!printOutputsHeader) { printOutputsHeader = document.createElement('h2'); printOutputsHeader.className = 'print-only-outputs-header'; printOutputsHeader.textContent = 'Our ROI'; outputSection.insertBefore(printOutputsHeader, screenOutputsHeader.nextSibling); }
                if (sliderWrapper.parentNode !== outputSection || !outputSection.contains(sliderWrapper)) { outputSection.insertBefore(sliderWrapper, firstOutputMetric ? firstOutputMetric : totalBenefitDiv); }
                sliderWrapper.style.display = 'block';
            } else { 
                 const screenH = outputSection.querySelector('.screen-only-outputs-header'); const printH = outputSection.querySelector('.print-only-outputs-header');
                 if(screenH) outputSection.removeChild(screenH); if(printH) outputSection.removeChild(printH);
                 sliderWrapper.style.display = 'none';
            }
            if (!hasInputs && inputsTitle.parentNode === inputSection) { inputSection.removeChild(inputsTitle); }
            // updateSliderImpactDisplay(parseFloat(estimateSlider.value)); // REMOVED
        }

        function calculateROI() {
            const sliderVal = parseFloat(estimateSlider.value) || 0;
            const sliderNormalized = sliderVal / 12.5; 

            const factorFor20PercentOutputs = 1 + (sliderNormalized * 0.20);
            const enpsActualImprovement = 20 + (sliderNormalized * 5); 

            const defaultCostPerVisit = 650, minCostPerVisit = 300, maxCostPerVisit = 1000;
            let dynamicCostPerVisitForIT;
            if (sliderNormalized >= 0) { dynamicCostPerVisitForIT = defaultCostPerVisit + sliderNormalized * (maxCostPerVisit - defaultCostPerVisit); } 
            else { dynamicCostPerVisitForIT = defaultCostPerVisit + sliderNormalized * (defaultCostPerVisit - minCostPerVisit); }
            dynamicCostPerVisitForIT = Math.max(minCostPerVisit, Math.min(maxCostPerVisit, dynamicCostPerVisitForIT));

            const currentInputs = {};
            for (const id in allInputReferences) { if (allInputReferences[id] && document.getElementById(id)) { currentInputs[id] = allInputReferences[id].value; } }
            
            let totalBenefit = 0;

            selectedValueAreas.forEach(areaKey => {
                const areaConfig = VALUE_AREAS[areaKey]; if (!areaConfig || typeof areaConfig.calculate !== 'function') return;
                const areaSpecificInputs = {};
                areaConfig.inputs.forEach(inputDef => { areaSpecificInputs[inputDef.id] = currentInputs[inputDef.id] !== undefined ? currentInputs[inputDef.id] : inputDef.value; });
                
                const baseResults = areaConfig.calculate(areaSpecificInputs);

                areaConfig.outputs.forEach(outputConf => {
                    const outputElement = document.getElementById(outputConf.id); if (!outputElement) return;
                    let value; let originalValueForDetail, improvementAmountForDetail, finalValueForDetail;

                    switch (areaKey) {
                        case 'content_engagement':
                            originalValueForDetail = baseResults.currentEngagementRateBaseline;
                            improvementAmountForDetail = baseResults.engagementUpliftBaseline * factorFor20PercentOutputs;
                            value = Math.max(0, Math.min(100, originalValueForDetail + improvementAmountForDetail));
                            finalValueForDetail = value;
                            break;
                        case 'employee_satisfaction':
                            if (outputConf.id === 'outputNewTurnoverRate') {
                                let targetReductionFactorOfOriginalRate;
                                const neutralReduction = 0.125; 
                                const aggressiveReduction = 0.24; 
                                const conservativeReduction = 0.05; 

                                if (sliderNormalized >= 0) { 
                                    targetReductionFactorOfOriginalRate = neutralReduction + sliderNormalized * (aggressiveReduction - neutralReduction);
                                } else { 
                                    targetReductionFactorOfOriginalRate = neutralReduction + sliderNormalized * (neutralReduction - conservativeReduction);
                                }
                                targetReductionFactorOfOriginalRate = Math.max(conservativeReduction, Math.min(aggressiveReduction, targetReductionFactorOfOriginalRate));
                                
                                const reductionInPercentagePoints = baseResults.baseTurnoverRateDecimal * targetReductionFactorOfOriginalRate;
                                const finalNewTurnoverRateDecimal = baseResults.baseTurnoverRateDecimal - reductionInPercentagePoints;
                                value = Math.max(0, finalNewTurnoverRateDecimal * 100); 

                                originalValueForDetail = baseResults.baseTurnoverRateDecimal * 100;
                                improvementAmountForDetail = reductionInPercentagePoints * 100; 
                                finalValueForDetail = value;

                            } else if (outputConf.id === 'outputTurnoverReductionSavings') {
                                let newTurnoverRateForSavingsCalc = 0;
                                const newTurnoverRateOutputVal = document.getElementById('outputNewTurnoverRate');
                                if (newTurnoverRateOutputVal && newTurnoverRateOutputVal.textContent) {
                                     newTurnoverRateForSavingsCalc = parseFloat(newTurnoverRateOutputVal.textContent.replace('%', '')) / 100.0;
                                } else { 
                                    let tempTargetReductionFactor;
                                    const neutralR = 0.125, aggressiveR = 0.24, conservativeR = 0.05;
                                    if (sliderNormalized >= 0) { tempTargetReductionFactor = neutralR + sliderNormalized * (aggressiveR - neutralR); } 
                                    else { tempTargetReductionFactor = neutralR + sliderNormalized * (neutralR - conservativeR); }
                                    tempTargetReductionFactor = Math.max(conservativeR, Math.min(aggressiveR, tempTargetReductionFactor));
                                    const tempReductionPP = baseResults.baseTurnoverRateDecimal * tempTargetReductionFactor;
                                    newTurnoverRateForSavingsCalc = Math.max(0, baseResults.baseTurnoverRateDecimal - tempReductionPP);
                                }
                               
                                const tempEmployeesRetained = Math.max(0, (baseResults.baseTurnoverRateDecimal - newTurnoverRateForSavingsCalc) * baseResults.numEmployees);
                                value = tempEmployeesRetained * (baseResults.avgAnnualWage * 0.4);
                            } else if (outputConf.id === 'outputNewEnps') {
                                originalValueForDetail = baseResults.currentEnpsBaseline;
                                improvementAmountForDetail = enpsActualImprovement; 
                                value = originalValueForDetail + improvementAmountForDetail;
                                finalValueForDetail = value;
                            }
                            break;
                        case 'safety_compliance': value = baseResults.outputComplianceSavingsBaseline * factorFor20PercentOutputs; break;
                        case 'it_maintenance': value = baseResults.siteVisits * dynamicCostPerVisitForIT; break;
                        case 'comms_efficiency':
                            if (outputConf.id === 'outputPrintSavings') { value = baseResults.outputPrintSavings; } 
                            else if (outputConf.id === 'outputCommsEfficiencySavings') { value = baseResults.outputCommsEfficiencySavingsBaseline * factorFor20PercentOutputs; }
                            break;
                        case 'employee_productivity': value = baseResults.outputProductivityValueBaseline * factorFor20PercentOutputs; break;
                        default: 
                            if(baseResults && baseResults[outputConf.id] !== undefined) { value = baseResults[outputConf.id]; } 
                            else { value = 0; }
                            break; 
                    }

                    if (outputConf.type === 'currency') {
                        outputElement.textContent = formatCurrency(value > 0 ? value : 0);
                        totalBenefit += (value > 0 ? value : 0);
                    } else if (outputConf.type === 'kpi') {
                        if (outputConf.id === 'outputNewEnps') { outputElement.textContent = Math.round(value); }
                        else { outputElement.textContent = formatPercentage(value, 1); }
                    } else { outputElement.textContent = value; }

                    const detailContainer = document.getElementById(`metricDetailContainer_${outputConf.id}`);
                    const detailTextEl = document.getElementById(`metricDetailText_${outputConf.id}`);
                    if (detailContainer && detailTextEl) {
                        let showDetail = false; let detailText = '';
                        if (outputConf.id === 'outputNewTurnoverRate') {
                            if (originalValueForDetail > 0 && Math.abs(improvementAmountForDetail) > 0.001) { 
                                detailText = `${formatPercentage(improvementAmountForDetail, 1)} improvement (from ${formatPercentage(originalValueForDetail,1)} to ${formatPercentage(finalValueForDetail,1)})`;
                                showDetail = true;
                            }
                        } else if (outputConf.id === 'outputNewEngagementRate') {
                            if (Math.abs(improvementAmountForDetail) > 0.001) {
                                detailText = `${formatPercentage(improvementAmountForDetail, 1)} increase (from ${formatPercentage(originalValueForDetail,1)} to ${formatPercentage(finalValueForDetail,1)})`;
                                showDetail = true;
                            }
                        } else if (outputConf.id === 'outputNewEnps') {
                             if (Math.abs(improvementAmountForDetail) >= 0.001) { // Check if there's any change from neutral for eNPS detail
                                detailText = `${Math.round(improvementAmountForDetail)} points improvement (from ${Math.round(originalValueForDetail)} to ${Math.round(finalValueForDetail)})`;
                                showDetail = true;
                            }
                        }
                        detailTextEl.textContent = detailText;
                        detailContainer.style.display = showDetail ? 'flex' : 'none';
                    }
                });
            });
            outputTotalAnnualBenefit.textContent = formatCurrency(totalBenefit > 0 ? totalBenefit : 0);
        }

        if (shareResultsBtn) { shareResultsBtn.addEventListener('click', function() { window.print(); }); }
        valueAreaSelector.style.display = 'block'; roiCalculatorMain.style.display = 'none'; 
        const storedSelections = localStorage.getItem('selectedRoiValueAreas');
        if (storedSelections) {
            selectedValueAreas = JSON.parse(storedSelections);
            selectedValueAreas.forEach(valKey => { const checkboxId = `chk${valKey.charAt(0).toUpperCase() + valKey.slice(1).replace(/_([a-z])/g, g => g[1].toUpperCase())}`; const checkbox = document.getElementById(checkboxId); if(checkbox) { checkbox.checked = true; const optionDiv = checkbox.closest('.value-option'); if(optionDiv) optionDiv.classList.add('selected'); } });
        }
        updateSelectionState(); 
        // updateSliderImpactDisplay(parseFloat(estimateSlider.value)); // REMOVED
        // Initialize slider text manually if needed, or remove if no text display is desired
        // For now, if #slider-value-display is removed from HTML, this call is not needed.

    });
    </script>
</body>
</html>
